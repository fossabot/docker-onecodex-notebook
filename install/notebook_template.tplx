((= IPython input/output style =))

((*- extends 'base.tplx' -*))

%===============================================================================
% Document
%===============================================================================
% Custom definitions
((* block definitions *))
    ((( super() )))

    % Pygments definitions
    ((( resources.latex.pygments_definitions )))

    \definecolor{lightgray}{HTML}{EEEEEE}
    \definecolor{mediumgray}{HTML}{AAAAAA}
((* endblock definitions *))

% for another latex template see: https://github.com/jupyter/nbconvert-examples/issues/12
((*- block docclass -*))
  \documentclass[floatfix, groupaddress, prb]{article}
((*- endblock docclass -*))

((* block packages *))
  \usepackage[framemethod=tikz]{mdframed}
  \usepackage[left=3cm,right=2cm,top=3cm,bottom=2cm]{geometry}
  \usepackage{titlesec}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  ((( super() )))
((* endblock packages *))


%===============================================================================
% Input
%===============================================================================

((* block input scoped *))
    \begin{mdframed}[hidealllines=true,backgroundcolor=lightgray]
    \begin{Verbatim}[commandchars=\\\{\}]
((( cell.source | highlight_code(strip_verbatim=True) )))
    \end{Verbatim}
    \end{mdframed}
((* endblock input *))


%===============================================================================
% Body
%===============================================================================

((* block commands *))
  \graphicspath{{"(((- nb.metadata.get('vars', {})['PATH_PREFIX'] -)))assets/"}{/opt/onecodex/}}
  % For header logos see: http://tex.stackexchange.com/questions/7630/add-logo-on-each-page
  ((* if nb.metadata.get('vars', {})['OTHER_REPORT_LOGO']: *))
    \lhead{\Oldincludegraphics[height=2em]{(((- nb.metadata.get('vars', {})['OTHER_REPORT_LOGO'] -)))}}
  ((* else *))
    \lhead{ }
  ((* endif *))
  \rhead{\Oldincludegraphics[height=2em]{one_codex_logo.png}}
  ((* if nb.metadata.get('vars', {})['ONE_CODEX_REPORT_UUID']: *))
  \lfoot{https://app.onecodex.com/report/(((- nb.metadata.get('vars', {})['ONE_CODEX_REPORT_UUID'] -)))}
  ((* endif *))
  \cfoot{}
  \rfoot{\thepage}

  \renewcommand\headrulewidth{0pt}
  \renewcommand\footrulewidth{0pt}
  \renewcommand{\footrule}{\color{mediumgray}}

  \renewcommand\thesection{}
  \renewcommand\thesubsection{}
  \renewcommand\thesubsubsection{}

  \titleformat{\section}
  {\normalfont\Large\bfseries}{\thesection}{0cm}{}
  \titleformat{\subsection}
  {\normalfont\large\bfseries}{\thesubsection}{0cm}{}
  \titleformat{\subsubsection}
  {\normalfont\bfseries}{\thesubsubsection}{0cm}{}


  ((( super() )))

  \hypersetup{
    ((*- if nb.metadata["title"]: -*))
      pdftitle={((( nb.metadata["title"] )))},
    ((*- endif *))
    ((*- if nb.metadata["author"]: -*))
      pdfauthor={((( nb.metadata["author"] )))},
    ((*- endif *))
    pdfproducer={ },
    pdfcreator={ },
  }
((* endblock commands *))

% using metadata to populate fields from:
% http://blog.juliusschulz.de/blog/ultimate-ipython-notebook

% make a title block for the first page
((* block title *))
  ((*- if nb.metadata["title"]: -*))
    \title{((( nb.metadata["title"] )))}
  ((*- endif *))
  ((*- if nb.metadata["author"]: -*))
    \author{((( nb.metadata["author"] )))}
  ((*- endif *))
  \date{}
((* endblock title *))

% TODO: add a metadata option that generates this along with a table of contents
((*- block maketitle -*))
  ((* if nb.metadata['title']: *))
    \maketitle\thispagestyle{fancy}
  ((* endif *))
((*- endblock maketitle -*))

% don't display input cells unless they have a metadata tag
((*- block input_group -*))
  ((* if cell.metadata.show_input == True: *))
    ((( super() )))
  ((* endif *))
((*- endblock input_group -*))

% Display raw cell types as latex for trusted inputs
((* block unknowncell *))
  ((* if nb.metadata.get('vars', {})['trusted'] == True: *))
    ((( cell.source )))
  ((* endif *))
((* endblock unknowncell *))
